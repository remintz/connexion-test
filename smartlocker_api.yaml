swagger: '2.0'
info:
  title: Smart Locker API
  version: '1.0'
consumes:
  - application/json
produces:
  - application/json
paths:
  /lockersets:
    get:
      tags:
        - Lockersets
      summary: Fetch lockersets
      parameters:
        - name: token
          description: authentication token
          in: header
          type: string
          required: true
        - name: code
          description: the lockerset code
          in: query
          type: string
          pattern: '^[a-zA-Z0-9]*$'
          required: false
      responses:
        '200':
          description: List of lockersets
          schema:
            type: array
            items:
              $ref: '#/definitions/Lockerset'
        '400':
          description: Lockerset code not found
        '401':
          description: Invalid token
    post:
      tags:
        - Lockersets
      summary: Create lockerset
      parameters:
        - name: token
          description: authentication token
          in: header
          type: string
          required: true
        - name: code
          description: the lockerset code
          in: header
          type: string
          pattern: '^[a-zA-Z0-9]*$'
          required: true
        - name: numBoxes
          description: number of boxes for this lockeset
          in: header
          type: integer
          required: true
      responses:
        '200':
          description: Lockerset created
          schema:
            type: array
            items:
              $ref: '#/definitions/Lockerset'
        '400':
          description: numBoxes value out of range
        '401':
          description: Invalid token
        '409':
          description: Lockerset already exists
  '/lockersets/{lockerset_code}':
    delete:
      tags:
        - Lockersets
      summary: Remove a Lockerset
      parameters:
        - $ref: '#/parameters/lockerset_code'
        - name: token
          description: authentication token
          in: header
          type: string
      responses:
        '204':
          description: Lockerset was deleted
        '401':
          description: Invalid token
        '404':
          description: Lockerset does not exist
  /users:
    get:
      tags:
        - Users
      summary: Fetch users
      responses:
        '200':
          description: Fetch a list of users
          schema:
            type: array
            items:
              $ref: '#/definitions/User'
      parameters:
        - name: token
          description: authentication token
          in: header
          type: string
          required: true
        - name: email
          description: user e-mail
          in: query
          type: string
    post:
      tags:
        - Users
      summary: Crate user
      description: Creates a user. The e-mail will be used as a login
      parameters:
        - name: token
          description: authentication token
          in: header
          type: string
          required: true
        - name: email
          description: user e-mail
          in: header
          type: string
          required: true
        - name: password
          description: user password
          in: header
          type: string
          format: password
          required: true
      responses:
        '200':
          description: User created
          schema:
            type: array
            items:
              $ref: '#/definitions/User'
        '400':
          description: Invalid email
        '401':
          description: Invalid token
        '409':
          description: User already exists
  '/users/{email}':
    delete:
      tags:
        - Users
      summary: Remove a User
      parameters:
        - name: token
          description: authentication token
          in: header
          type: string
          required: true
        - $ref: '#/parameters/email'
      responses:
        '204':
          description: User was deleted
        '401':
          description: Invalid token
        '404':
          description: User does not exist
  /sessions:
    post:
      tags:
        - Session
      summary: >-
        Creates a new session. If other session exists for the same user, delete
        it
      parameters:
        - name: email
          description: user e-mail
          in: header
          type: string
          required: true
        - name: password
          description: user password
          in: header
          type: string
          format: password
          required: true
      responses:
        '200':
          description: Session created
          schema:
            type: array
            items:
              $ref: '#/definitions/Session'
        '400':
          description: Invalid user or password
  /lockerbox:
    get:
      tags:
        - Lockersets
      summary: Returns a list of locker boxes according to the query performed
      parameters:
        - name: token
          description: authentication token
          in: header
          type: string
          required: true
        - name: lockersetCode
          description: the code for the lockerset being searched
          in: query
          type: string
          required: true
        - name: onlyAvailable
          description: if looking just for available boxes
          in: query
          type: boolean
          allowEmptyValue: true
          required: false
        - name: onlyone
          description: >-
            if looking for just one value, for example, when selecting an
            available box for a user
          in: query
          type: boolean
          allowEmptyValue: true
          required: false
      responses:
        '200':
          description: List of boxes
          schema:
            type: array
            items:
              $ref: '#/definitions/LockerBox'
        '401':
          description: Invalid token
    put:
      tags:
        - Lockersets
      summary: Changes the box status
      description: >-
        used to change the box status such as when opening the box, storing or
        retrieving an object
      parameters:
        - name: token
          description: authentication token
          in: header
          type: string
          required: true
        - name: lockersetCode
          description: the code for the lockerset being searched
          in: query
          type: string
          required: true
        - name: lockerBoxNumber
          in: query
          description: the number of the box
          type: integer
          required: true
        - name: operation
          description: the command to be applied to the box
          in: query
          type: string
          enum:
            - Open
            - Store
          required: true
        - name: key
          description: the key required when command=Open
          in: query
          type: string
          required: false
      responses:
        '200':
          description: when operation=Store returns the second key
          schema:
            $ref: '#/definitions/LockerBoxPutResponse'
        '401':
          description: Invalid token
  /secondkey:
    get:
      tags:
        - Lockersets
      summary: gets the secondary key
      parameters:
        - name: token
          description: authentication token
          in: header
          type: string
          required: true
        - name: lockersetCode
          description: the code for the lockerset
          in: query
          type: string
          required: true
        - name: lockerBoxNumber
          description: the box number
          in: query
          type: integer
          required: true
        - name: asURL
          description: present if wants the URL for the key and not the key itself
          in: query
          type: boolean
          allowEmptyValue: true
          required: false
      responses:
        '200':
          description: Returns the key
          schema:
            type: object
            items:
              $ref: '#/definitions/LockerBoxKey'
        '401':
          description: Invalid token
parameters:
  lockerset_code:
    name: lockerset_code
    description: Lockerset's Unique identifier
    in: path
    type: string
    required: true
    pattern: '^[a-zA-Z0-9-]+$'
  email:
    name: email
    description: user's email address
    in: path
    type: string
    required: true
definitions:
  Lockerset:
    type: object
    properties:
      id:
        type: integer
        format: int64
      code:
        type: string
      numBoxes:
        type: integer
  User:
    type: object
    properties:
      id:
        type: integer
        format: int64
      email:
        type: string
  Session:
    type: object
    properties:
      token:
        type: string
      email:
        type: string
      expiration:
        type: string
        format: date-time
  LockerBox:
    type: object
    properties:
      lockersetId:
        type: integer
        format: int64
      lockersetCode:
        type: string
      lockerBoxNumber:
        type: integer
  LockerBoxPutResponse:
    type: object
    properties:
      lockersetId:
        type: integer
        format: int64
      lockersetCode:
        type: string
      lockerBoxNumber:
        type: integer
        format: int16
      secondKey:
        type: string
  LockerBoxKey:
    type: object
    properties:
      key:
        type: string
      url:
        type: string
